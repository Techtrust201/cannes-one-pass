// Prisma schema pour "palais_des_festivals"
// généré par l'assistant

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum AccreditationStatus {
  ATTENTE
  ENTREE
  SORTIE
  NOUVEAU
  REFUS
  ABSENT
}

enum HistoryAction {
  CREATED
  STATUS_CHANGED
  VEHICLE_ADDED
  VEHICLE_REMOVED
  VEHICLE_UPDATED
  EMAIL_SENT
  INFO_UPDATED
  DELETED
  ZONE_CHANGED
  ZONE_TRANSFER
}

enum VehicleType {
  PORTEUR
  PORTEUR_ARTICULE
  SEMI_REMORQUE
}

enum Zone {
  LA_BOCCA
  PALAIS_DES_FESTIVALS
  PANTIERO
  MACE
}

enum ZoneAction {
  ENTRY
  EXIT
  TRANSFER
}

enum CountryRegion {
  FRANCE
  ESPAGNE
  ITALIE
  ALLEMAGNE
  BELGIQUE
  SUISSE
  ROYAUME_UNI
  PAYS_BAS
  PORTUGAL
  AUTRE
}

model Accreditation {
  id          String               @id @default(uuid())
  createdAt   DateTime             @default(now())
  company     String
  stand       String
  unloading   String
  event       String
  message     String?
  consent     Boolean              @default(false)
  status      AccreditationStatus  @default(ATTENTE)
  entryAt     DateTime?
  exitAt      DateTime?
  email       String?              @db.VarChar(255)
  sentAt      DateTime?
  currentZone Zone?

  vehicles       Vehicle[]
  emailHistory   AccreditationEmailHistory[]
  history        AccreditationHistory[]
  zoneMovements  ZoneMovement[]
}

model Vehicle {
  id              Int          @id @default(autoincrement())
  plate           String
  size            String
  phoneCode       String
  phoneNumber     String
  date            String
  time            String
  city            String
  unloading       String       @db.Text
  kms             String?
  
  // Nouveaux champs pour le bilan carbone
  vehicleType     VehicleType?
  country         CountryRegion?
  estimatedKms    Int          @default(0)
  arrivalDate     DateTime?
  departureDate   DateTime?

  // Champs poids (en tonnes)
  emptyWeight     Int?
  maxWeight       Int?
  currentWeight   Int?

  accreditation   Accreditation @relation(fields: [accreditationId], references: [id], onDelete: Cascade)
  accreditationId String
}

model ZoneMovement {
  id              Int           @id @default(autoincrement())
  accreditation   Accreditation @relation(fields: [accreditationId], references: [id], onDelete: Cascade)
  accreditationId String
  fromZone        Zone?
  toZone          Zone
  action          ZoneAction
  timestamp       DateTime      @default(now())
  userId          String?
  userAgent       String?
}

model AccreditationEmailHistory {
  id              Int           @id @default(autoincrement())
  accreditation   Accreditation @relation(fields: [accreditationId], references: [id], onDelete: Cascade)
  accreditationId String
  email           String
  sentAt          DateTime      @default(now())
}

model AccreditationHistory {
  id              Int             @id @default(autoincrement())
  accreditation   Accreditation   @relation(fields: [accreditationId], references: [id], onDelete: Cascade)
  accreditationId String
  action          HistoryAction
  field           String?         // Champ modifié (ex: "status", "company", etc.)
  oldValue        String?         // Ancienne valeur
  newValue        String?         // Nouvelle valeur
  description     String          // Description lisible de l'action
  userId          String?         // ID de l'utilisateur qui a fait la modification
  userAgent       String?         // User agent pour tracer l'origine
  createdAt       DateTime        @default(now())
} 